<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Voice Room ‚Äî Ariana v0.1 ¬∑ Illumina (Froot Core Ready)</title>
<meta name="theme-color" content="#0b0d11" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<style>
  :root{
    --bg:#0b0d11; --card:#12151b; --ink:#EDECF5; --muted:#9aa3ad;
    --accent:#f6d7e6; /* pearl-rose */
    --accent-2:#f8f1e7; /* vanilla haze */
    --accent-3:#f2b8a0; /* rose-gold */
    --accent-4:#e7e0c3; /* champagne olive */
    --accent-5:#c9b6e7; /* amethyst pearl */
    --good:#7ee787; --warn:#f7c843; --bad:#f47174;
  }
  html,body{height:100%;background:var(--bg);color:var(--ink);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;}
  *{box-sizing:border-box}
  .wrap{max-width:980px;margin:0 auto;padding:16px 14px 120px}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(11,13,17,.9),rgba(11,13,17,.6) 60%,transparent);backdrop-filter: blur(8px);z-index:10}
  .bar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;padding:12px 0}
  .title{font-weight:700;font-size:20px;letter-spacing:.2px}
  .subtle{color:var(--muted);font-size:12px}
  button,.btn{background:#1a1f27;color:var(--ink);border:1px solid #222936;border-radius:12px;padding:10px 12px;font-weight:600;cursor:pointer}
  button:hover{border-color:#2d3645}
  .ghost{background:transparent;border-color:#2a3240}
  .primary{background:linear-gradient(180deg,#2a3240,#1d2330);border-color:#394356}
  .accent{background:linear-gradient(180deg,var(--accent),#f0bed4);color:#1b0f14;border:0}
  input[type="file"]{display:none}
  label.file{display:inline-flex;align-items:center;gap:8px}
  .grid{display:grid;grid-template-columns: 1fr; gap:12px}
  @media(min-width:860px){.grid{grid-template-columns: 1.2fr .8fr}}
  .player{background:var(--card);border:1px solid #222936;border-radius:16px;padding:12px}
  .list{background:var(--card);border:1px solid #222936;border-radius:16px}
  .row{display:grid;grid-template-columns: 1.6fr .9fr .9fr auto; gap:10px; align-items:center; padding:12px 12px; border-top:1px solid #1b212c}
  .row:first-child{border-top:0}
  .song-title{font-weight:700}
  .tag{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid #2b3444;color:var(--muted)}
  .tag.swatch::before{content:"";width:10px;height:10px;border-radius:50%;display:inline-block;border:1px solid rgba(255,255,255,.2);}
  .pill{display:inline-flex;align-items:center;gap:8px;background:#0f131a;border:1px solid #262f3d;border-radius:12px;padding:8px 10px;color:var(--muted)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .inline-edit{display:none;margin-top:10px;border-top:1px dashed #2a3240;padding-top:10px}
  .inline-edit input,.inline-edit textarea{width:100%;background:#0f131a;border:1px solid #263142;border-radius:10px;padding:10px;color:var(--ink)}
  .inline-edit small{color:var(--muted)}
  details{background:#10151d;border-top:1px solid #1c2431;padding:10px 12px;border-radius:12px}
  details[open]{outline:1px solid #2a3446}
  summary{cursor:pointer;color:var(--muted)}
  .kbd{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:12px; background:#0f131a; border:1px solid #2a3240; padding:2px 6px; border-radius:6px;}
  .slider{width:160px}
  .footer{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(11,13,17,.0),rgba(11,13,17,.9));backdrop-filter: blur(8px);}
  .footbar{max-width:980px;margin:0 auto;display:flex;align-items:center;gap:10px;padding:10px 14px}
  .status-dot{width:10px;height:10px;border-radius:50%;background:#374151;border:1px solid #111}
  .status-dot.on{background:var(--good)}
  .badge{font-size:11px;border:1px solid #2b3444;border-radius:999px;padding:4px 8px;color:var(--muted)}
  .row .controls button{padding:8px 10px}
  .hint{font-size:12px;color:var(--muted)}
  .note{color:#e9e2ff}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="bar">
        <div>
          <div class="title">Voice Room ‚Äî <span style="color:var(--accent)">Ariana</span> <span class="badge">v0.1</span></div>
          <div class="subtle">Mode: <b>VOICE</b> ¬∑ Palette: Pearl‚ÄëRose ¬∑ Engine: Froot Core compatible</div>
        </div>
        <div style="margin-left:auto" class="controls">
          <label class="file btn ghost" title="Load a JSON pack">
            <input id="fileIn" type="file" accept="application/json" />üì• Import
          </label>
          <button class="btn primary" id="saveAll">üíæ Save</button>
          <button class="btn" id="exportBtn">üì§ Export Edited Names & IDs</button>
        </div>
      </div>
    </header>

    <div class="grid" id="app">
      <section class="player">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px">
          <div class="pill">Main Player</div>
          <div class="pill">Queue: <span id="qStatus" class="hint">7 tracks ¬∑ loop</span></div>
          <div class="pill">Tone <span id="toneHzBadge" class="kbd">‚Äî</span></div>
        </div>
        <div id="playerContainer" style="aspect-ratio:16/9; background:#0f131a; border:1px solid #1e2633; border-radius:12px; overflow:hidden">
          <div id="player"></div>
        </div>
        <div class="bar" style="padding:12px 0 0">
          <div class="controls">
            <button id="prevBtn">‚èÆ Prev</button>
            <button id="playBtn" class="primary">‚ñ∂Ô∏è Play</button>
            <button id="pauseBtn">‚è∏ Pause</button>
            <button id="nextBtn">‚è≠ Next</button>
            <button id="loopBtn" class="ghost" title="Loop queue">üîÅ Loop</button>
          </div>
          <div class="controls" style="margin-left:auto">
            <button id="toneToggle" class="ghost">üîä Tone: Off</button>
            <label class="pill">Level <input id="toneGain" class="slider" type="range" min="0" max="100" value="30" /></label>
            <button id="muteTone" class="ghost">üôä Mute</button>
          </div>
        </div>
        <div class="hint" style="margin-top:8px">Tip: keep tone ~ ‚àí24 to ‚àí30 dB under the song; use system AirPlay if needed (video ‚Üí target, keep tone on device).</div>
      </section>

      <section class="list">
        <div class="row" style="grid-template-columns: 2fr 1fr 1fr auto;">
          <div class="hint">Title / Artist</div>
          <div class="hint">Seed</div>
          <div class="hint">Tone</div>
          <div class="hint">Actions (Edit ‚Üí Save ‚Üí Info)</div>
        </div>
        <div id="rows"></div>
      </section>
    </div>
  </div>

  <div class="footer">
    <div class="footbar">
      <div class="status-dot" id="ytStatus"></div>
      <div class="hint">YouTube API</div>
      <div class="status-dot" id="audioStatus"></div>
      <div class="hint">Audio Engine</div>
      <div class="status-dot" id="loopStatus" title="Queue loop"></div>
      <div class="hint">Loop</div>
      <div style="margin-left:auto" class="hint">Energy Path: <b>Ground ‚Üí Flow ‚Üí Rest</b></div>
    </div>
  </div>

<script>
// ---------------------------
// Data (Froot Core compatible)
// ---------------------------
const PACK = [
  { artist:"Ariana Grande", title:"no tears left to cry", yt:"", hex:"#F6D7E6", toneHz:160, seed:"Pearl Lift", tags:["Voice","Lift","Resilience"], blurb:"Switch-on song: when the day tilts sideways, we tilt back up.", noteToAri:"This is our click-into-buoyancy‚Äîthank you for making resilience feel musical.", expl:"Bounce-back energy; flipping heaviness to upward spiral (Bee ‚Üí Flow)." },
  { artist:"Ariana Grande", title:"be alright", yt:"", hex:"#F8F1E7", toneHz:128.15, seed:"Little Mantra", tags:["Calm","Breath"], blurb:"Pocket calm. Two minutes with this resets the room.", noteToAri:"We use this like breath tabs‚Äîthank you for a soft way to reset.", expl:"Micro-mantra rhythm; teaches body calm via small, repeatable phrases." },
  { artist:"Ariana Grande", title:"into you", yt:"", hex:"#F2B8A0", toneHz:192, seed:"Playful Precision", tags:["Articulation","Sparkle"], blurb:"Flirt without static‚Äîclarity that still winks.", noteToAri:"This track teaches us clean edges without losing warmth.", expl:"Playful precision; consonant sparkle trains articulation (Voice mode)." },
  { artist:"Ariana Grande", title:"positions", yt:"", hex:"#E7E0C3", toneHz:216, seed:"Agile Center", tags:["Switching","Timing"], blurb:"Move parts around‚Äîcenter stays put.", noteToAri:"We practice flexible clarity with this‚Äîit keeps work playful.", expl:"Adaptive agility; role-shifting without losing center (Bee agility drills)." },
  { artist:"Ariana Grande", title:"god is a woman", yt:"", hex:"#C9B6E7", toneHz:256, seed:"Open Glow", tags:["Embodied","Open"], blurb:"Stand soft, sound big.", noteToAri:"This is our posture reminder‚Äîease first, power follows.", expl:"Embodied voice; open jaw & chest, confidence without push." },
  // Message tracks
  { artist:"Ariana Grande", title:"imagine", yt:"", hex:"#EFEAE2", toneHz:144, seed:"Kind Vision", tags:["Message","You‚ÜíHer"], blurb:"A soft offer: we could make a little world.", noteToAri:"This is me speaking quietly: if it‚Äôs right, let‚Äôs build something kind.", expl:"Your gentle, sincere ask; vision over demand (You ‚Üí Ariana)." },
  { artist:"Ariana Grande", title:"pov", yt:"", hex:"#F0C9D7", toneHz:170, seed:"Gentle Mirror", tags:["Message","Her‚ÜíYou"], blurb:"Borrow my eyes for a minute‚Äîlook how worthy you are.", noteToAri:"This one teaches us to hold a kinder mirror. We‚Äôre practicing.", expl:"Mirror song; invites you to see yourself with her softness (Ariana ‚Üí You)." }
];

// ---------------------------
// App State
// ---------------------------
let state = {
  list: JSON.parse(JSON.stringify(PACK)),
  currentIndex: 0,
  loop: true,
  player: null,
  audio: { ctx:null, osc:null, gain:null, on:false, muted:false }
};

// ---------------------------
// DOM Helpers
// ---------------------------
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function status(el, on){ el.classList.toggle('on', !!on); }

function downloadJSON(filename, data){
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 300);
}

// ---------------------------
// Render List
// ---------------------------
function renderList(){
  const rows = state.list.map((item, i)=>{
    const toneText = (item.toneHz+"").replace(/\.0+$/,'');
    return `
      <div class="row" data-i="${i}">
        <div>
          <div class="song-title">${item.title} <span class="subtle">‚Äî ${item.artist}</span></div>
          <div class="controls" style="margin-top:6px">
            <span class="tag swatch" style="--sw:${item.hex};"><i class="swatch" style="background:${item.hex}"></i> ${item.hex}</span>
            <span class="tag">${item.tags.join(' ¬∑ ')}</span>
          </div>
          <div class="inline-edit" id="edit-${i}">
            <div style="display:grid;grid-template-columns:1.4fr .8fr .8fr;gap:8px;align-items:start">
              <div>
                <label class="hint">Title</label>
                <input data-k="title" value="${escapeHtml(item.title)}"/>
              </div>
              <div>
                <label class="hint">YouTube ID <small>(11 chars)</small></label>
                <input data-k="yt" value="${escapeHtml(item.yt||'')}" placeholder="e.g. ffxKSjUwKdU"/>
              </div>
              <div>
                <label class="hint">Hex Color</label>
                <input data-k="hex" value="${escapeHtml(item.hex)}"/>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr .5fr;gap:8px;margin-top:8px">
              <div>
                <label class="hint">Blurb (website copy)</label>
                <textarea data-k="blurb" rows="2">${escapeHtml(item.blurb||'')}</textarea>
              </div>
              <div>
                <label class="hint">Tone (Hz)</label>
                <input data-k="toneHz" type="number" step="0.01" value="${item.toneHz}"/>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
              <div>
                <label class="hint">Seed</label>
                <input data-k="seed" value="${escapeHtml(item.seed||'')}"/>
              </div>
              <div>
                <label class="hint">Note to Ariana (from us)</label>
                <input data-k="noteToAri" value="${escapeHtml(item.noteToAri||'')}"/>
              </div>
            </div>
            <div style="margin-top:8px"><small class="hint">Order: <span class="kbd">Edit</span> ‚Üí <span class="kbd">Save</span>. You can Export anytime.</small></div>
          </div>
        </div>
        <div>${item.seed}</div>
        <div><span class="kbd">${toneText} Hz</span></div>
        <div class="controls" style="justify-content:flex-end">
          <button class="ghost play">‚ñ∂Ô∏è Play</button>
          <button class="ghost edit">‚úèÔ∏è Edit</button>
          <button class="primary save">üíæ Save</button>
          <button class="ghost info">‚ÑπÔ∏è Info</button>
        </div>
      </div>
      <div class="row" style="grid-template-columns: 1fr; display:none" id="info-${i}">
        <details open>
          <summary>More about ‚Äú${escapeHtml(item.title)}‚Äù</summary>
          <div style="display:grid;grid-template-columns: 1fr 1fr; gap:10px; margin-top:8px">
            <div>
              <div class="hint">Illumina Fit</div>
              <div>${escapeHtml(item.expl||'')}</div>
              <div style="margin-top:8px" class="hint">Website Blurb</div>
              <div>${escapeHtml(item.blurb||'')}</div>
            </div>
            <div>
              <div class="hint">Tone & Color</div>
              <div>Pair with <span class="kbd">${toneText} Hz</span>; color swatch <span class="kbd">${item.hex}</span>.</div>
              <div class="hint" style="margin-top:8px">Note to Ariana</div>
              <div class="note">${escapeHtml(item.noteToAri||'')}</div>
            </div>
          </div>
        </details>
      </div>
    `;
  }).join('');
  $('#rows').innerHTML = rows;
  bindRowEvents();
  updateQueueBadge();
}

function bindRowEvents(){
  $$('#rows .row').forEach(row=>{
    const i = Number(row.dataset.i);
    if (!Number.isInteger(i)) return; // skip info rows
    row.querySelector('.play').onclick = ()=> playIndex(i);
    row.querySelector('.edit').onclick = ()=> toggleEdit(i, true);
    row.querySelector('.save').onclick = ()=> saveRow(i);
    row.querySelector('.info').onclick = ()=> toggleInfo(i);
  });
}

function toggleEdit(i, on){
  const el = $('#edit-'+i); if(!el) return; el.style.display = on ? 'block' : (el.style.display==='block'?'none':'block');
}
function toggleInfo(i){
  const info = $('#info-'+i); if(!info) return; info.style.display = (info.style.display==='none'||!info.style.display) ? 'block' : 'none';
}

function saveRow(i){
  const root = $('#edit-'+i); if(!root) return;
  const inputs = root.querySelectorAll('[data-k]');
  inputs.forEach(inp=>{
    const k = inp.getAttribute('data-k');
    let v = inp.value;
    if(k==='toneHz') v = Number(v);
    state.list[i][k] = v;
  });
  toggleEdit(i,false);
  renderList();
}

function updateQueueBadge(){
  $('#qStatus').textContent = `${state.list.length} tracks ¬∑ ${state.loop? 'loop' : 'no loop'}`;
  status($('#loopStatus'), state.loop);
}

// ---------------------------
// YouTube Player
// ---------------------------
let YT_API_READY = false;
function onYouTubeIframeAPIReady(){
  YT_API_READY = true; status($('#ytStatus'), true); buildPlayer();
}
function buildPlayer(){
  if(!YT_API_READY) return;
  if(state.player) return;
  state.player = new YT.Player('player', {
    height:'100%', width:'100%', videoId: state.list[0].yt || null,
    playerVars:{ rel:0, modestbranding:1, playsinline:1 },
    events:{
      onReady: ()=>{},
      onStateChange: (e)=>{
        // 0 = ended
        if(e.data === YT.PlayerState.ENDED){
          nextTrack();
        }
      }
    }
  });
}
function loadVideoByIndex(i){
  const item = state.list[i];
  if(!item.yt){ alert('This track has no YouTube ID yet. Click ‚úèÔ∏è Edit to set one.'); return; }
  state.player.loadVideoById(item.yt);
  state.currentIndex = i;
  // set tone for this track
  setToneHz(item.toneHz);
  document.body.style.setProperty('--accent', item.hex||'#f6d7e6');
  $('#toneHzBadge').textContent = `${item.toneHz} Hz`;
}
function playIndex(i){
  if(!state.player){ buildPlayer(); }
  // auto-start tone when playing a track (if toggled on)
  loadVideoByIndex(i);
}
function nextTrack(){
  const n = state.currentIndex + 1;
  const next = n < state.list.length ? n : (state.loop ? 0 : null);
  if(next===null) return;
  loadVideoByIndex(next);
}
function prevTrack(){
  const p = state.currentIndex - 1;
  const prev = p >= 0 ? p : (state.loop ? state.list.length-1 : null);
  if(prev===null) return;
  loadVideoByIndex(prev);
}

// ---------------------------
// Audio (Tone Engine)
// ---------------------------
function ensureAudio(){
  if(state.audio.ctx) return;
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type = 'sine';
  gain.gain.value = dbToGain(-28); // default under bed
  osc.connect(gain).connect(ctx.destination);
  osc.start();
  state.audio = {ctx,osc,gain,on:false, muted:false};
  status($('#audioStatus'), true);
}
function dbToGain(db){ return Math.pow(10, db/20); }
function setToneHz(hz){ ensureAudio(); state.audio.osc.frequency.value = hz; }
function setToneLevelFromSlider(v){
  // slider 0..100 -> dB range -48..-6
  const db = -48 + (v/100)*(42);
  state.audio.gain.gain.value = dbToGain(db);
}
function toggleTone(){ ensureAudio(); state.audio.on = !state.audio.on; $('#toneToggle').textContent = state.audio.on? 'üîä Tone: On' : 'üîá Tone: Off'; state.audio.gain.gain.value = state.audio.on ? state.audio.gain.gain.value : 0; if(state.audio.on && state.audio.muted){ state.audio.muted=false; $('#muteTone').textContent='üôä Mute'; } }
function muteTone(){ ensureAudio(); state.audio.muted = !state.audio.muted; $('#muteTone').textContent = state.audio.muted? 'üîà Unmute' : 'üôä Mute'; state.audio.gain.gain.value = state.audio.muted? 0 : state.audio.gain.gain.value || dbToGain(-28); }

// ---------------------------
// Import / Export / Save
// ---------------------------
function exportEdited(){
  const lean = state.list.map(({artist,title,yt,hex,toneHz,seed,tags,blurb})=>({artist,title,yt,hex,toneHz,seed,tags,blurb}));
  downloadJSON('ariana_voice_pack.json', lean);
}

function loadFromFile(file){
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const data = JSON.parse(reader.result);
      if(!Array.isArray(data)) throw new Error('Expected an array');
      // gentle merge if same title, else replace
      const byTitle = new Map(state.list.map((x)=>[x.title.toLowerCase(), x]));
      data.forEach(item=>{
        if(item && item.title){ byTitle.set(item.title.toLowerCase(), {...byTitle.get(item.title.toLowerCase()), ...item}); }
      });
      state.list = Array.from(byTitle.values());
      renderList();
    }catch(e){ alert('Import error: '+e.message); }
  };
  reader.readAsText(file);
}

function saveAll(){
  // no backend; this simply re-renders to ensure edits are reflected
  renderList();
}

// ---------------------------
// Event Wiring (UI)
// ---------------------------
$('#prevBtn').onclick = prevTrack;
$('#nextBtn').onclick = nextTrack;
$('#playBtn').onclick = ()=>{ if(state.list[state.currentIndex].yt){ loadVideoByIndex(state.currentIndex); } else { alert('Current track missing YouTube ID ‚Äî choose a track or edit an ID first.'); } };
$('#pauseBtn').onclick = ()=>{ if(state.player) state.player.pauseVideo(); };
$('#loopBtn').onclick = ()=>{ state.loop = !state.loop; updateQueueBadge(); };

$('#toneToggle').onclick = toggleTone;
$('#muteTone').onclick = muteTone;
$('#toneGain').oninput = (e)=> setToneLevelFromSlider(Number(e.target.value));

$('#exportBtn').onclick = exportEdited;
$('#saveAll').onclick = saveAll;
$('#fileIn').onchange = (e)=>{ if(e.target.files && e.target.files[0]) loadFromFile(e.target.files[0]); e.target.value=''; };

// ---------------------------
// Utils
// ---------------------------
function escapeHtml(str){ return (str+"").replace(/[&<>"]/g, s=> ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[s])); }

// ---------------------------
// Boot
// ---------------------------
renderList();
setToneHz(state.list[0].toneHz);

</script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
// Fallback to mark API load failure after 5s
setTimeout(()=>{ if(!window.YT || !YT.loaded){ status(document.getElementById('ytStatus'), false); } }, 5000);
</script>

<!-- Imagined note from Ariana (site footer copy):
  "Hey love‚Äîkeep it light and honest. Breathe first, then say it clean. Let the fun in. You‚Äôre already worthy. I‚Äôm rooting for your voice to feel like home." ‚ú®
-->
</body>
</html>
