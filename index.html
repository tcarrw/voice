<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voice ¬∑ Expression Field ‚Äî 128 Hz</title>
<meta name="description" content="Voice ‚Äî an expression field: silky 128 Hz base with Clarity (shelf + compressor) and Presence (gentle harmonics). Pitch bend ¬±100¬¢. Mobile-clean header, linked ribbon." />
<meta name="theme-color" content="#0b0d11" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#0b0d11">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --bg:#0b0d11; --ink:#ecf1f9; --muted:#aeb4c4; --ring:#1a2236;
    --card:#0f1427; --aqua:#b5f0ea; --honey:#ffd37a; --rose:#ffbcd4;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:radial-gradient(1200px 700px at 50% -10%, #141a33 0%, #0b0d11 38%, #0b0d11 100%);color:var(--ink);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:900px;margin:0 auto;padding:16px 16px 72px}

  header{padding:12px 16px 0}
  .brand{display:flex;align-items:center;gap:10px}
  .glyph{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#1b2337,#0f1220);display:grid;place-items:center;box-shadow:inset 0 0 0 1px #222b46}
  .glyph span{font-size:16px}
  h1{font-size:18px;margin:0 0 6px 0}
  .tag{font-size:12px;color:#c9d1e2}

  .ribbon{
    margin:10px 0 8px;display:flex;gap:8px;overflow:auto;padding-bottom:2px;
    -webkit-overflow-scrolling:touch;scrollbar-width:none
  }
  .ribbon::-webkit-scrollbar{display:none}
  .chip{
    white-space:nowrap;font-size:13px;padding:8px 12px;border-radius:999px;flex:0 0 auto;
    background:#121a34;border:1px solid #2a3457;color:#e5ebfb
  }
  .chip[data-hi="1"]{border-color:#2e6f78;background:#10262a}

  .card{
    background:linear-gradient(180deg,#0f1427 0%, #0b0f1e 100%);border:1px solid var(--ring);
    border-radius:14px;padding:14px;box-shadow:0 10px 28px #0007;margin:12px 0;position:relative
  }
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .controls{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:660px){ .controls{grid-template-columns:1fr 1fr 1fr} }

  button,.pill{
    appearance:none;border:1px solid #2a3457;background:#121a34;color:var(--ink);
    padding:10px 14px;border-radius:999px;font-weight:600;letter-spacing:.2px
  }
  button:active{transform:translateY(1px)}
  .on{background:linear-gradient(90deg,#0f3440,#0b2530);border-color:#2e6f78;box-shadow:0 0 0 1px #17434a inset, 0 0 20px #0c2b30}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#121a34;border:1px solid #2a3457;font-size:13px}
  label{font-size:13px;color:var(--muted)}
  input[type="range"]{width:100%}

  .meter{height:8px;background:#0e1326;border:1px solid #1f2744;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,#b5f0ea,#ffd37a,#ffbcd4);transition:width .35s ease}

  .note{font-size:14px;color:#cfd6ea}
  .soft{color:#b0b6c8}
  .footer{opacity:.9;text-align:center;font-size:12px;color:#aab1c6;margin-top:10px}

  .alive:after{
    content:"";position:absolute;inset:-1px;border-radius:14px;pointer-events:none;
    background:radial-gradient(600px 160px at 20% -50%, #b5f0ea22, transparent 70%),
               radial-gradient(800px 200px at 80% -60%, #ffd37a22, transparent 75%)
  }
</style>
</head>
<body>
  <header class="wrap" aria-label="Site header">
    <div class="brand">
      <div class="glyph"><span>üéôÔ∏è</span></div>
      <div>
        <h1>Voice ¬∑ <span style="text-shadow:0 0 14px #b5f0ea77">Expression Field</span></h1>
        <div class="tag">128 Hz base ¬∑ Clarity (shelf+compressor) ¬∑ Presence (harmonics) ¬∑ mobile-clean header</div>
      </div>
    </div>

    <nav class="ribbon" aria-label="Sites">
      <a class="chip" href="https://mirrorhoney.plnt.earth/">MirrorHoney</a>
      <a class="chip" href="https://earth.plnt.earth/">Earth</a>
      <a class="chip" href="https://honey.plnt.earth/">Honey</a>
      <a class="chip" href="https://mask.plnt.earth/">Mask</a>
      <a class="chip" data-hi="1" href="https://voice.plnt.earth/">Voice</a>
      <a class="chip" href="https://jar.plnt.earth/">Jar</a>
      <a class="chip" href="https://froot.plnt.earth/">Froot</a>
      <a class="chip" href="https://tunes.plnt.earth/">Tunes</a>
      <a class="chip" href="https://bridge.plnt.earth/">Bridge</a>
    </nav>
  </header>

  <main class="wrap" id="main">
    <section class="card alive" aria-label="Voice tone controls">
      <div class="row" style="justify-content:space-between;gap:10px">
        <div class="badge">üéôÔ∏è Voice ‚Äî 128 Hz</div>
        <div class="badge">Status: <strong id="statusText">Off</strong></div>
      </div>

      <div class="row" style="margin-top:8px;gap:10px">
        <button id="startBtn" class="pill">‚ñ∂Ô∏é Start Voice</button>
        <button id="stopBtn"  class="pill">‚ñ† Stop</button>
        <button id="clarityBtn" class="pill" aria-pressed="false">‚óã Clarity: Off</button>
        <button id="presenceBtn" class="pill" aria-pressed="false">‚óã Presence: Off</button>
      </div>

      <div class="controls" style="margin-top:10px">
        <div>
          <label for="volume">Level</label>
          <input id="volume" type="range" min="0" max="100" value="60" step="1" />
        </div>
        <div>
          <label for="bend">Pitch Bend (¬¢)</label>
          <input id="bend" type="range" min="-100" max="100" value="0" step="1" />
        </div>
        <div>
          <label for="presenceAmt">Presence Amount</label>
          <input id="presenceAmt" type="range" min="0" max="1" value="0.4" step="0.01" />
        </div>
      </div>

      <div class="meter" style="margin-top:10px"><div class="bar" id="meterBar"></div></div>

      <p class="note" style="margin-top:10px">
        Tap <b>Start Voice</b> once to unlock audio on iPhone. <b>Clarity</b> boosts articulate frequencies and gently compresses.
        <b>Presence</b> adds a soft harmonic lift for confidence. Bend ¬±100¬¢ to find your effortless speaking pitch.
      </p>
    </section>

    <section class="card" aria-label="Speak practice">
      <div class="badge">üîä Speak</div>
      <p class="note">
        Warm for 30‚Äì60 seconds. When the tone feels silky, say one sentence out loud that you can ship today.
        If your jaw tightens, lower the level and add a small negative bend (‚àí10 to ‚àí20¬¢).
      </p>
      <p class="soft">Need warmth? <a href="https://honey.plnt.earth/">Honey</a>. Need grounding? <a href="https://earth.plnt.earth/">Earth</a>. For Marina‚Äôs page, <a href="https://mirrorhoney.plnt.earth/">MirrorHoney</a>.</p>
    </section>

    <div class="footer">Night-safe UI ¬∑ zero-network WebAudio ¬∑ smooth ramps ¬∑ no overlays.</div>
  </main>

<script>
(() => {
  // UI
  const statusText  = document.getElementById('statusText');
  const startBtn    = document.getElementById('startBtn');
  const stopBtn     = document.getElementById('stopBtn');
  const clarityBtn  = document.getElementById('clarityBtn');
  const presenceBtn = document.getElementById('presenceBtn');
  const vol         = document.getElementById('volume');
  const bend        = document.getElementById('bend');
  const presenceAmt = document.getElementById('presenceAmt');
  const bar         = document.getElementById('meterBar');

  // WebAudio: osc -> shaper -> eq -> comp -> gain -> out
  let ctx, osc, shaper, shelf, comp, gain;
  let on=false, clarity=false, presence=false;

  function ensureCtx(){
    if(!ctx){
      ctx = new (window.AudioContext || window.webkitAudioContext)({latencyHint:'playback'});
      gain = ctx.createGain(); gain.gain.value = 0.0001;

      // Soft waveshaper for Presence harmonics
      shaper = ctx.createWaveShaper();
      setShaperAmount(parseFloat(presenceAmt.value)||0.4);

      // High-shelf EQ for Clarity
      shelf = ctx.createBiquadFilter(); shelf.type = 'highshelf';
      shelf.frequency.value = 2500; shelf.gain.value = 0; // off by default

      // Gentle compressor
      comp = ctx.createDynamicsCompressor();
      comp.threshold.value = -28; comp.knee.value = 24; comp.ratio.value = 2.2;
      comp.attack.value = 0.01; comp.release.value = 0.18;

      // Chain: shaper -> shelf -> comp -> gain -> out
      shaper.connect(shelf); shelf.connect(comp); comp.connect(gain); gain.connect(ctx.destination);
    }
  }

  function setBadge(v){ statusText.textContent = v ? 'On' : 'Off'; startBtn.classList.toggle('on', v); }
  function setToggle(btn, v, onLabel, offLabel){
    btn.textContent = v ? onLabel : offLabel;
    btn.setAttribute('aria-pressed', v ? 'true' : 'false');
    btn.classList.toggle('on', v);
  }

  function rampGain(target, ms){
    if(!gain) return;
    const now = ctx.currentTime, dur = Math.max(0.06,(ms||250)/1000);
    const current = gain.gain.value;
    gain.gain.cancelScheduledValues(now);
    gain.gain.setValueAtTime(current, now);
    gain.gain.linearRampToValueAtTime(target, now + dur);

    // UI meter
    const start = parseFloat(bar.style.width)||0;
    const end = Math.round(Math.min(100, Math.max(0, target*100)));
    const t0 = performance.now(), T = Math.max(60,(ms||250));
    function step(ts){
      const k = Math.min(1,(ts - t0)/T);
      bar.style.width = Math.round(start + (end-start)*k) + '%';
      if(k<1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  function baseLevel(){ return Math.min(1, Math.max(0, vol.value/100)); }

  function setShaperAmount(a){
    // a in [0..1]; create soft-saturation curve
    const n = 256, curve = new Float32Array(n);
    const k = a * 2.0; // gentle
    for(let i=0;i<n;i++){
      const x = (i/(n-1))*2-1;
      curve[i] = (1+k)*x/(1+k*Math.abs(x));
    }
    shaper.curve = curve;
  }

  function applyPresence(){
    setShaperAmount(presence ? (parseFloat(presenceAmt.value)||0.4) : 0);
  }

  function applyClarity(){
    shelf.gain.setTargetAtTime(clarity ? 5.5 : 0, ctx.currentTime, 0.1); // dB
  }

  function applyBend(){
    if(!osc) return;
    const cents = parseFloat(bend.value)||0; // ¬±100
    osc.detune.setTargetAtTime(cents, ctx.currentTime, 0.05);
  }

  async function start(){
    ensureCtx();
    if(on) return;
    if(ctx.state === 'suspended'){ try{ await ctx.resume(); }catch(_){ } }

    osc = ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(128, ctx.currentTime);
    osc.connect(shaper);

    applyBend();
    applyClarity();
    applyPresence();

    osc.start();
    rampGain(baseLevel(), 420);
    on = true; setBadge(true);
  }

  function stop(){
    if(!ctx || !osc || !on) return;
    rampGain(0.0001, 300);
    const o = osc;
    setTimeout(()=>{ try{ o.stop(); o.disconnect(); }catch(_){} }, 320);
    on = false; setBadge(false);
    osc = null;
  }

  // UI bindings
  startBtn.addEventListener('click', start);
  stopBtn .addEventListener('click', stop);

  clarityBtn.addEventListener('click', () => {
    clarity = !clarity;
    setToggle(clarityBtn, clarity, '‚óè Clarity: On', '‚óã Clarity: Off');
    if(ctx) applyClarity();
  });

  presenceBtn.addEventListener('click', () => {
    presence = !presence;
    setToggle(presenceBtn, presence, '‚óè Presence: On', '‚óã Presence: Off');
    if(ctx) applyPresence();
  });

  vol.addEventListener('input', () => { if(ctx){ rampGain(baseLevel(), 140); } });
  bend.addEventListener('input', applyBend);
  presenceAmt.addEventListener('input', () => { if(presence) applyPresence(); });

  document.addEventListener('visibilitychange', () => setBadge(on && !document.hidden));

  // Init UI
  setBadge(false);
  setToggle(clarityBtn,false,'‚óè Clarity: On','‚óã Clarity: Off');
  setToggle(presenceBtn,false,'‚óè Presence: On','‚óã Presence: Off');
  bar.style.width = vol.value + '%';
})();
</script>
</body>
</html>
